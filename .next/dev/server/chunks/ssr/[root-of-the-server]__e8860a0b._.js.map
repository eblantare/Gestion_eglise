{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/projets/frontend/contexts/AuthContext.tsx"],"sourcesContent":["// contexts/AuthContext.tsx\n'use client'\n\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react'\nimport { useRouter } from 'next/navigation'\n\ninterface User {\n  id: number\n  username: string\n  email: string\n  first_name: string\n  last_name: string\n}\n\ninterface Profile {\n  id: number\n  role: 'VISITOR' | 'MEMBER' | 'DEACON' | 'ELDER' | 'PASTOR' | 'ADMIN' | 'WEBMASTER'\n  phone?: string\n  is_active: boolean\n}\n\ninterface AuthContextType {\n  user: User | null\n  profile: Profile | null\n  token: string | null\n  isAuthenticated: boolean\n  isLoading: boolean\n  isAdmin: boolean\n  isWebmaster: boolean\n  canManageContent: boolean\n  login: (username: string, password: string) => Promise<void>\n  register: (data: RegisterData) => Promise<void>\n  logout: () => void\n  refreshUser: () => Promise<void>\n}\n\ninterface RegisterData {\n  username: string\n  password: string\n  email: string\n  first_name: string\n  last_name: string\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext)\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider')\n  }\n  return context\n}\n\n// Fonction utilitaire pour gérer le localStorage en toute sécurité\nconst safeLocalStorage = {\n  getItem(key: string): string | null {\n    if (typeof window === 'undefined') return null\n    try {\n      return localStorage.getItem(key)\n    } catch (error) {\n      console.error(`LocalStorage error (get ${key}):`, error)\n      return null\n    }\n  },\n\n  setItem(key: string, value: string): void {\n    if (typeof window === 'undefined') return\n    try {\n      localStorage.setItem(key, value)\n    } catch (error) {\n      console.error(`LocalStorage error (set ${key}):`, error)\n    }\n  },\n\n  removeItem(key: string): void {\n    if (typeof window === 'undefined') return\n    try {\n      localStorage.removeItem(key)\n    } catch (error) {\n      console.error(`LocalStorage error (remove ${key}):`, error)\n    }\n  },\n\n  getJSON<T>(key: string): T | null {\n    const item = this.getItem(key)\n    if (!item || item === 'undefined') return null\n    try {\n      return JSON.parse(item) as T\n    } catch (error) {\n      console.error(`LocalStorage error (parse ${key}):`, error)\n      this.removeItem(key)\n      return null\n    }\n  },\n\n  setJSON(key: string, value: any): void {\n    this.setItem(key, JSON.stringify(value))\n  }\n}\n\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\n  const [user, setUser] = useState<User | null>(null)\n  const [profile, setProfile] = useState<Profile | null>(null)\n  const [token, setToken] = useState<string | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n  const router = useRouter()\n\n  useEffect(() => {\n    // Vérifier l'authentification au chargement de manière sécurisée\n    const storedToken = safeLocalStorage.getItem('access_token')\n    const storedUser = safeLocalStorage.getJSON<User>('user')\n    const storedProfile = safeLocalStorage.getJSON<Profile>('profile')\n    \n    if (storedToken && storedUser) {\n      setToken(storedToken)\n      setUser(storedUser)\n      if (storedProfile) {\n        setProfile(storedProfile)\n      }\n    }\n    setIsLoading(false)\n  }, [])\n\n  const isAuthenticated = !!user && !!token\n  const isAdmin = profile?.role === 'ADMIN' || profile?.role === 'WEBMASTER'\n  const isWebmaster = profile?.role === 'WEBMASTER'\n  const canManageContent = ['ADMIN', 'WEBMASTER', 'PASTOR'].includes(profile?.role || '')\n\n  const login = async (username: string, password: string) => {\n    try {\n      setIsLoading(true)\n      const response = await fetch('http://localhost:8000/api/members/auth/login/', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ username, password }),\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}))\n        throw new Error(errorData.error || 'Identifiants invalides')\n      }\n\n      const data = await response.json()\n      \n      // Stocker les données en toute sécurité\n      safeLocalStorage.setItem('access_token', data.access)\n      safeLocalStorage.setItem('refresh_token', data.refresh)\n      safeLocalStorage.setJSON('user', data.user)\n      \n      // Note: votre API backend renvoie 'member' et non 'profile'\n      if (data.member) {\n        safeLocalStorage.setJSON('member', data.member)\n        setProfile(data.member)\n      }\n      \n      setToken(data.access)\n      setUser(data.user)\n      \n      router.push('/')\n    } catch (error) {\n      console.error('Login error:', error)\n      throw error\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const register = async (data: RegisterData) => {\n    try {\n      setIsLoading(true)\n      const response = await fetch('http://localhost:8000/api/members/auth/register/', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}))\n        throw new Error(errorData.error || 'Erreur lors de l\\'inscription')\n      }\n\n      const result = await response.json()\n      \n      // Stocker les données en toute sécurité\n      safeLocalStorage.setItem('access_token', result.access)\n      safeLocalStorage.setItem('refresh_token', result.refresh)\n      safeLocalStorage.setJSON('user', result.user)\n      \n      // Note: votre API backend renvoie 'member' et non 'profile'\n      if (result.member) {\n        safeLocalStorage.setJSON('member', result.member)\n        setProfile(result.member)\n      }\n      \n      setToken(result.access)\n      setUser(result.user)\n      \n      router.push('/')\n    } catch (error) {\n      console.error('Register error:', error)\n      throw error\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const logout = () => {\n    // Nettoyer le localStorage de manière sécurisée\n    safeLocalStorage.removeItem('access_token')\n    safeLocalStorage.removeItem('refresh_token')\n    safeLocalStorage.removeItem('user')\n    safeLocalStorage.removeItem('member')\n    safeLocalStorage.removeItem('profile') // Pour compatibilité\n    \n    setToken(null)\n    setUser(null)\n    setProfile(null)\n    \n    router.push('/')\n  }\n\n  const refreshUser = async () => {\n    if (!token) return\n    \n    try {\n      const response = await fetch('http://localhost:8000/api/members/auth/me/', {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json',\n        },\n      })\n\n      if (response.ok) {\n        const data = await response.json()\n        safeLocalStorage.setJSON('user', data.user)\n        if (data.member) {\n          safeLocalStorage.setJSON('member', data.member)\n          setProfile(data.member)\n        }\n        setUser(data.user)\n      } else if (response.status === 401) {\n        // Token invalide, déconnecter\n        logout()\n      }\n    } catch (error) {\n      console.error('Refresh user error:', error)\n    }\n  }\n\n  return (\n    <AuthContext.Provider value={{\n      user,\n      profile,\n      token,\n      isAuthenticated,\n      isLoading,\n      isAdmin,\n      isWebmaster,\n      canManageContent,\n      login,\n      register,\n      logout,\n      refreshUser,\n    }}>\n      {children}\n    </AuthContext.Provider>\n  )\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 244, "column": 0}, "map": {"version":3,"sources":["file:///C:/projets/frontend/app/page.tsx"],"sourcesContent":["// app/page.tsx\n'use client'\n\nimport { useEffect } from 'react'\nimport Link from 'next/link'\nimport { useAuth } from '@/contexts/AuthContext'\n\nexport default function HomePage() {\n  const { isLoading } = useAuth()\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen\">\n      {/* Votre contenu existant */}\n      <div className=\"text-center py-20\">\n        <h1 className=\"text-4xl font-bold mb-6\">Bienvenue sur notre site</h1>\n        <p className=\"text-lg text-gray-600 mb-8\">Contenu de votre page d'accueil</p>\n        <Link \n          href=\"/login\" \n          className=\"inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition\"\n        >\n          Se connecter\n        </Link>\n      </div>\n    </div>\n  )\n}"],"names":[],"mappings":"AAAA,eAAe;;;;;;AAIf;AACA;AAJA;;;;AAMe,SAAS;IACtB,MAAM,EAAE,SAAS,EAAE,GAAG,IAAA,mIAAO;IAE7B,IAAI,WAAW;QACb,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;;;;;;;;;;IAGrB;IAEA,qBACE,8OAAC;QAAI,WAAU;kBAEb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAA0B;;;;;;8BACxC,8OAAC;oBAAE,WAAU;8BAA6B;;;;;;8BAC1C,8OAAC,uKAAI;oBACH,MAAK;oBACL,WAAU;8BACX;;;;;;;;;;;;;;;;;AAMT"}}]
}
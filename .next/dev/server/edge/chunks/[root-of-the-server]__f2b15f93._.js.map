{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["// frontend/middleware.ts - VERSION CORRIGÉE\nimport { NextResponse } from 'next/server'\nimport type { NextRequest } from 'next/server'\n\nexport function middleware(request: NextRequest) {\n  const token = request.cookies.get('access_token')?.value\n  const path = request.nextUrl.pathname\n\n  // Routes publiques qui ne nécessitent pas d'authentification\n  const publicPaths = [\n    '/', \n    '/auth/login', \n    '/auth/register',\n    '/auth/forgot-password',\n    '/events',\n    '/sermons',\n    '/contact',\n    '/about',\n    '/beliefs',\n    '/ministries',\n    '/cdej',\n    '/cdej/programmes'\n  ]\n  \n  // Routes protégées nécessitant une authentification\n  const protectedPaths = [\n    '/profile',\n    '/dashboard',\n    '/members'\n  ]\n  \n  // Routes admin seulement\n  const adminPaths = [\n    '/admin',\n    '/admin/dashboard',\n    '/admin/members',\n    '/admin/events',\n    '/admin/sermons',\n    '/admin/posts',\n    '/admin/media',\n    '/admin/settings',\n    '/admin/users'\n  ]\n\n  // Vérifier si c'est une route admin\n  const isAdminPath = adminPaths.some(adminPath => path.startsWith(adminPath))\n  \n  // Vérifier si c'est une route protégée\n  const isProtectedPath = protectedPaths.some(protectedPath => path.startsWith(protectedPath))\n  \n  // Si c'est une route publique, laisser passer\n  const isPublicPath = publicPaths.some(publicPath => \n    path === publicPath || path.startsWith(`${publicPath}/`)\n  )\n\n  // Récupérer les informations utilisateur\n  const userData = request.cookies.get('user')?.value\n  let userRole = 'VISITOR'\n  let isAdmin = false\n  let isWebmaster = false\n  \n  if (userData) {\n    try {\n      const user = JSON.parse(userData)\n      userRole = user.member?.role || 'VISITOR'\n      isAdmin = userRole === 'ADMIN'\n      isWebmaster = userRole === 'WEBMASTER'\n    } catch (e) {\n      console.error('Error parsing user data:', e)\n    }\n  }\n\n  // Redirection si non authentifié sur route protégée\n  if ((isProtectedPath || isAdminPath) && !token) {\n    const loginUrl = new URL('/auth/login', request.url)\n    loginUrl.searchParams.set('redirect', path)\n    return NextResponse.redirect(loginUrl)\n  }\n\n  // Redirection si non admin sur route admin\n  if (isAdminPath && !(isAdmin || isWebmaster)) {\n    return NextResponse.redirect(new URL('/', request.url))\n  }\n\n  // Redirection si webmaster seulement sur certaines routes\n  if (path.startsWith('/admin/users') && !isWebmaster) {\n    return NextResponse.redirect(new URL('/admin/dashboard', request.url))\n  }\n\n  // Redirection si déjà connecté sur login/register\n  if ((path === '/auth/login' || path === '/auth/register') && token) {\n    return NextResponse.redirect(new URL('/', request.url))\n  }\n\n  // Ajouter des headers de sécurité\n  const response = NextResponse.next()\n  \n  // Headers de sécurité\n  response.headers.set('X-Frame-Options', 'DENY')\n  response.headers.set('X-Content-Type-Options', 'nosniff')\n  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin')\n  \n  return response\n}\n\n// CORRECTION ICI : La regex doit être correctement formée\nexport const config = {\n  matcher: [\n    '/((?!api|_next/static|_next/image|favicon\\\\.ico|public).*)/',\n  ],\n}"],"names":[],"mappings":"AAAA,4CAA4C;;;;;;;AAC5C;AAAA;;AAGO,SAAS,WAAW,OAAoB;IAC7C,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,iBAAiB;IACnD,MAAM,OAAO,QAAQ,OAAO,CAAC,QAAQ;IAErC,6DAA6D;IAC7D,MAAM,cAAc;QAClB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,oDAAoD;IACpD,MAAM,iBAAiB;QACrB;QACA;QACA;KACD;IAED,yBAAyB;IACzB,MAAM,aAAa;QACjB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,oCAAoC;IACpC,MAAM,cAAc,WAAW,IAAI,CAAC,CAAA,YAAa,KAAK,UAAU,CAAC;IAEjE,uCAAuC;IACvC,MAAM,kBAAkB,eAAe,IAAI,CAAC,CAAA,gBAAiB,KAAK,UAAU,CAAC;IAE7E,8CAA8C;IAC9C,MAAM,eAAe,YAAY,IAAI,CAAC,CAAA,aACpC,SAAS,cAAc,KAAK,UAAU,CAAC,GAAG,WAAW,CAAC,CAAC;IAGzD,yCAAyC;IACzC,MAAM,WAAW,QAAQ,OAAO,CAAC,GAAG,CAAC,SAAS;IAC9C,IAAI,WAAW;IACf,IAAI,UAAU;IACd,IAAI,cAAc;IAElB,IAAI,UAAU;QACZ,IAAI;YACF,MAAM,OAAO,KAAK,KAAK,CAAC;YACxB,WAAW,KAAK,MAAM,EAAE,QAAQ;YAChC,UAAU,aAAa;YACvB,cAAc,aAAa;QAC7B,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,4BAA4B;QAC5C;IACF;IAEA,oDAAoD;IACpD,IAAI,CAAC,mBAAmB,WAAW,KAAK,CAAC,OAAO;QAC9C,MAAM,WAAW,IAAI,IAAI,eAAe,QAAQ,GAAG;QACnD,SAAS,YAAY,CAAC,GAAG,CAAC,YAAY;QACtC,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,2CAA2C;IAC3C,IAAI,eAAe,CAAC,CAAC,WAAW,WAAW,GAAG;QAC5C,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;IACvD;IAEA,0DAA0D;IAC1D,IAAI,KAAK,UAAU,CAAC,mBAAmB,CAAC,aAAa;QACnD,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,oBAAoB,QAAQ,GAAG;IACtE;IAEA,kDAAkD;IAClD,IAAI,CAAC,SAAS,iBAAiB,SAAS,gBAAgB,KAAK,OAAO;QAClE,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;IACvD;IAEA,kCAAkC;IAClC,MAAM,WAAW,gMAAY,CAAC,IAAI;IAElC,sBAAsB;IACtB,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IAExC,OAAO;AACT;AAGO,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}